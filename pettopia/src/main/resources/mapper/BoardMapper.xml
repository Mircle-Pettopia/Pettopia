<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.pettopia.board.mapper.BoardMapper">
	<select id="showArticle" resultType="BoardTestVO">
		select * from board_test where no=#{no}
	</select>
	<insert id="insertArticle"
		parameterType="BoardTestVO">
		insert into board_test
		values(#{no},#{title},#{contents})
	</insert>
	
	<!-- 은애수정 2023/05/18 , 지식공유게시판 글작성 -->
	<insert id="insertKnowhowArticle" parameterType="BoardVO">
		INSERT INTO board
					(BO_NO,
					 TITLE,
					 SUBJECT,
					 ME_ID,
					 bo_type)
		VALUES(
					(SELECT TO_NUMBER(NVL(MAX(bo_no),0))+1 bo_no FROM board)
					,#{title}
					,#{subject}
					,#{meId}
					,'BY1')
	</insert>
	
	<!-- 은애수정 2023/05/18 , 지식공유게시판 전체조회 -->
	<select id="knowHowList" resultType="BoardVO">
		SELECT *  FROM ( SELECT ROWNUM AS rn,a.*
		                 FROM (
		                       SELECT bo_no,title,reg_dt,view_cnt,me_id 
		                       FROM board 
		                       WHERE title LIKE '%'||''||'%'
		                       AND bo_type = 'BY1'
		                       ORDER BY bo_no DESC
		) a	) WHERE RN BETWEEN (#{page}-1)*10 and #{page}*10
	</select>
	
	<!-- 은애수정 2023/05/18 -->
	<select id="showKnowHow" resultType="BoardVO">
		SELECT * FROM board WHERE bo_no=#{boNo}
	</select>
	
	<!-- 은애수정 2023/05/18, 지식공유게시판 글 개수 -->
	<select id="knowHowMaxPage" resultType="int">
		SELECT COUNT(*)
		FROM board
		WHERE title LIKE '%'|| #{keyword} ||'%'
		AND bo_type = 'BY1'
	</select>
	
	<select id="getknowHowReply" resultType="BoardVO">
		SELECT * from reply 
		WHERE DIVISION = 'DR2' 
		  AND BO_NO=#{boNo} 
		  AND RE IS NULL
		ORDER BY comment_id desc
	</select>
	
	<!-- 은애수정 2023/05/18 -->
	<insert id="insertKnowHowReply" parameterType="BoardVO">
		INSERT INTO reply
			(comment_id,me_id,subject,division,bo_no)
		VALUES
			(reply_seq.nextval,#{meId},#{subject},'DR2',#{boNo})
	</insert>
	
	<!-- 은애수정 2023/05/18 -->
	<update id="KnowHowAddhit" parameterType="int">
		UPDATE board SET view_cnt=view_cnt+1 WHERE BO_NO = #{boNo}
	</update>
	
	<!-- 은애수정 2023/05/18 -->
	<delete id="delKnowHow" parameterType="int">
		DELETE board WHERE bo_no = #{boNo}
	</delete>
	
	<delete id="delKnowHow2" parameterType="int">
		DELETE reply WHERE BO_NO = #{boNo} AND DIVISION = 'DR2'
	</delete>
	
	<select id="getKnowHowWriter" parameterType="int" resultType="String">
		SELECT ME_ID FROM KNOWHOW_BOARD where BO_NO = #{boNo}
	</select>
	
	<!-- 은애수정 2023/05/18 -->
	<update id="updateKnowHow" parameterType="BoardVO">
		UPDATE board
			SET title = #{title}, subject=#{subject}
		WHERE BO_NO=#{boNo}
	</update>
	
	<delete id="delKnowHowReply" parameterType="int">
		DELETE REPLY WHERE comment_id=#{commentId} AND DIVISION = 'DR2'
	</delete>
	
	<!-- 은애!!!!!! -->
	<select id="getBoardAllList" resultType="BoardVO">
		SELECT * FROM ( SELECT ROWNUM AS rn, a.*
		                FROM(
	                            SELECT
	                            	get_common(bo_type) bo_type,
	                            	bo_no,
	                                title,
	                                subject,
	                                reg_dt,
	                                view_cnt
	                            FROM board
	                            WHERE 1=1
	                            AND me_id = #{meId}
	                            AND title LIKE '%' || #{keyword} || '%'
	                            <if test="boType != null and !boType.equals('')">
	                            AND bo_type = #{boType}
	                            </if>
	                            ORDER BY bo_no DESC) a
		                )
		WHERE RN between (#{page}-1)*10 and #{page}*10
	</select>
	
	<select id="boardAllMaxPage" resultType="int">
		SELECT count(*)
		FROM board 
		WHERE 1=1
		AND title LIKE '%'||#{keyword}||'%'
		AND me_id = #{meId}
	</select>
	
	
</mapper>