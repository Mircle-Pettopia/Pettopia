<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layout}">
<head>
<meta charset="UTF-8" />
<title>Pettopia</title>
</head>
<body>
	<div layout:fragment="content">
		<section class="section">
			<div class="row">
				<div class="col-lg-12">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">회원 관리</h5>
							<div class="col-lg-12 p-4"></div>
							<div class="card-body">
								<select class="dataTable-selector" name="searchParam"
									id="searchParam">
									<option selected value="">전체</option>
									<option value="memId">아이디</option>
									<option value="memNm">이름</option>
									<option value="matCd">?</option>
								</select> <input type="text" class="form-control" id="searchMat"
									name="searchMat"
									style="width: 150px; height: 36px; display: inline-block;" />
								<button class="btn btn-primary" id="searchBtn">
									<i class="fas fa-search"></i> 검색
								</button>
							</div>




							<div id="memberList"></div>
						</div>
					</div>
				</div>
			</div>
		</section>
		
	<div
        class="modal fade"
        id="detailModal"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
      >
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">상품 상세조회</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >상품명</label
                >
                <div class="col-sm-4">
                  <input type="text" class="form-control" id="prdtNmDetail" />
                </div>
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >판매가</label
                >
                <div class="col-sm-4">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="prdtPrcDetail"
                  />
                </div>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >상품설명</label
                >
                <form>
                  <textarea id="summernoteDetail" name="editordata"></textarea>
                </form>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >대분류</label
                >
                <div class="col-sm-6 mt-2">
                  <div
                    class="form-check form-check-inline"
                    th:each="lCat : ${lCatList}"
                  >
                    <input
                      class="form-check-input"
                      type="radio"
                      name="lCatId"
                      th:value="${lCat.lCatId}"
                      th:id="${lCat.lCatId}+'Det'"
                    />
                    <label
                      class="form-check-label"
                      th:for="${lCat.lCatId}+'Det'"
                      th:text="${lCat.lCatNm}"
                    ></label>
                  </div>
                </div>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >소분류</label
                >
                <div class="col-sm-7 mt-2" id="sCatListDetail"></div>
              </div>

              <div>
                <div class="row mb-4" id="optionDetail">
                  <!-- <div class="row mb-4">
                    <label class="col-sm-2 col-form-label fw-bolder text-center"
                      >옵션 이름</label
                    >
                    <div class="col-sm-4">
                      <input type="text" class="form-control" />
                    </div>
                  </div>
                  <label class="col-sm-2 col-form-label fw-bolder text-center"
                    >옵션 값</label
                  >
                  <div class="col-sm-4">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="콤마(,)로 구분해주세요"
                    />
                  </div>
                  <label class="col-sm-2 col-form-label fw-bolder text-center"
                    >추가 가격</label
                  >
                  <div class="col-sm-4">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="콤마(,)로 구분해주세요"
                    />
                  </div> -->
                </div>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >이미지(메인)</label
                >
                <div class="col-sm-6">
                  <img id="imgMainDetail" />
                </div>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >이미지</label
                >
                <div class="col-sm-10" id="imgDetail"></div>
              </div>
              <div class="row mb-4">
                <label class="col-sm-2 col-form-label fw-bolder text-center"
                  >판매상태</label
                >
                <div class="col-sm-6 mt-2">
                  <div
                    class="form-check form-check-inline"
                    th:each="saleSt : ${code.ST}"
                  >
                    <input
                      class="form-check-input"
                      type="radio"
                      name="saleSt"
                      th:id="${saleSt.codCd} + 'Det'"
                      th:value="${saleSt.codCd}"
                    />
                    <label
                      class="form-check-label"
                      th:for="${saleSt.codCd} + 'Det'"
                      th:text="${saleSt.codTitle}"
                    ></label>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                닫기
              </button>
              <button type="button" class="btn btn-primary">수정</button>
            </div>
          </div>
        </div>
      </div>

		<script>
			const Grid = tui.Grid;

			const memberList = new Grid({
				el : document.getElementById("memberList"),
				rowHeaders : [ "checkbox", "rowNum" ],
				bodyHeight : 430,
				pageOptions : {
					useClient : true,
					perPage : 10,
				},
				columns : [ {
					header : "아이디",
					name : "meId",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "이름",
					name : "name",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "전화번호",
					name : "phone",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "주소",
					name : "addr",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "상세주소",
					name : "addrDetail",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "우편번호",
					name : "post",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "가입일자",
					name : "signDt",
					align : "center",
					sortingType : "asc",
					sortable : true,
					formatter : function(e) {
						return formattedDate(e.value);
					},
				}, {
					header : "수정일자",
					name : "updateDt",
					align : "center",
					sortingType : "asc",
					sortable : true,
					formatter : function(e) {
						return formattedDate(e.value);
					},
				}, {
					header : "가입경로",
					name : "signPath",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "탈퇴여부",
					name : "outYn",
					align : "center",
					sortingType : "asc",
					sortable : true,
				}, {
					header : "권한",
					name : "role",
					align : "center",
					sortingType : "asc",
					sortable : true,
				},

				],
			});

			// 날짜 변환
			function formattedDate(timestamp) {
				let date = new Date(timestamp);
				let year = date.getFullYear();
				let month = String(date.getMonth() + 1).padStart(2, "0");
				let day = String(date.getDate()).padStart(2, "0");
				let formattedDate = year + "-" + month + "-" + day;
				return formattedDate;
			}

			$.ajax({
				url : "memberList",
				dataType : "JSON",
				success : function(data) {
					memberList.resetData(data);
				},
				error : function(reject) {
					console.log(reject);
				},
			});
			
			
			
			memberList.on('dblclick', ev => {
				var meId = memberList.getValue(ev.rowKey, 'meId')
				var name = memberList.getValue(ev.rowKey, 'name')
				$.ajax({
					url: "memberDetailList",
					method: 'Post',
					dataType: 'JSON',
					data: {
						meId: meId,
						name: name,
					},
					success: function (result) {
						grid2.resetData(result)
						for (var all of result) {
							var rscStc = all.rscStc
							if (rscStc == null || rscStc == 0 || rscStc == '') {
								rscStc = 0;
							}
							var allStc = Number(all.ordrCnt) + Number(all.rscStc)
							grid2.setValue(all.rowKey, 'allStc', allStc)
							grid2.setValue(all.rowKey, 'rscStc', rscStc)
							$('#ordrCd').val(ordrCd)
						}
						$('#exampleModal').modal('show');
						setTimeout(function () {
							grid2.refreshLayout()
						}, 300);

					}
				})
			})

		</script>
	</div>
</body>
</html>
