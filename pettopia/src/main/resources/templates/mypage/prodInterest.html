<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<html lang="ko" itemscope itemtype="http://schema.org/WebPage">
<head>
    <title>Pettopia</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<body>
<div layout:fragment="content">
    <style>
        button{
            font-size: 11px !important;
        }

        h3 {
            text-align: center;
            margin: 30px 0px;
        }

        .table-shopping-cart {
            /* height: 250px; */
            overflow: auto;
            margin-top: 20px;
        }

        .table-shopping-cart>table {
            width: 100%;
        }

        td img {
            width: 100px;
        }

        .btnSet {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        table input {
            width: 30px !important;
        }
        
        tr, td, th, span, p{
            font-size: 13px !important;
        }

        th, td {
            text-align: center;
        }

        td, tr, th{
            vertical-align: middle !important;
        }

        .optionW{
            width: 200px;
        }

        .optionTitle{
            width: 100px !important;
            display: inline-block;;
        }
    </style>

    <div class="container">
        <div class="row">
            <th:block th:replace="/layout/navbar :: navbarFragment"></th:block>
            <!-- 마이페이지 관심상품 -->
            <div class="col-md-8 col-lg-10 p-b-80 fontSize">
                <div class="p-r-45 p-r-0-lg m-t-50">
                    <h1>
                        <span style="font-weight: bold; color: rgb(201, 159, 240);">| </span>관심상품
                    </h1>
                    <h3 class="noonnu_font">
                        <img src="img/free-icon.png" style="width: 35px;"> <sapn id="name" th:text="${name}" ></sapn>
                        님의 관심상품목록 <img src="img/free-icon.png" style="width: 35px;"></h3>
                    <h5>기본정보</h5>

                    <!--모달-->
                    <!--<div id="modal" class="w3-modal m-t-50">
                        <div class="w3-modal-content w3-animate-opacity w3-card-4">
                        <span onclick="document.getElementById('modal').style.display='none'" 
                        class="w3-button w3-display-topright">&times;</span>
                        <h2>옵션선택</h2>
                        <div class="w3-container" style="height: 400px !important;">
                            <div id="option"></div>
                        </div>
                        </div>
                    </div>--> <!--end 모달-->

                    <!--table-->
                    <div>
                        <!--<div class="how-itemcart1"></div>
                        <div class="how-itemcart1"></div>
                        <div class="how-itemcart1"></div>-->
                        <table class="table">
                            <colgroup>
                                    <col width="15%">
                                    <col width="25%">
                                    <col width="30%">
                                    <col width="15%">
                                    <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th>
                                        <div style="margin:0 auto; display:inline-block;">
                                            <input type="checkbox">
                                        </div>
                                    </th>
                                    <th>이미지</th>
                                    <th>상품정보</th>
                                    <th>판매가</th>
                                    <th>선택</th>
                                </tr>
                            </thead>

                            <!-- ↓↓↓여기에 조회된 결과 출력 -->
                            <tbody id="list">
                                <!--<tr>
                                    <td>
                                        <div style="margin:0 auto; display:inline-block;">
                                            <input type="checkbox">
                                        </div>
                                    </td>
                                    <td><img src="images/item-cart-02.jpg" alt=""></td>
                                    <td class="column-3">
                                        <span>남성 기모 맨투맨L</span>
                                        <div>2023-04-28</div>
                                        <div style="margin:0 auto; display:inline-block;">
                                            <button type="button" class="btn btnPush btnOrange">옵션변경</button>
                                        </div>
                                    </td>
                                    <td>42,000원</td>
                                    <td>
                                        <div style="margin:0 auto; display:inline-block;">
                                            <button type="button" class="btn btnPush btnBlueGreen">장바구니</button>
                                        </div>
                                    </td>
                                </tr>-->
                            </tbody>
                        </table>
                        <div class="btnSet">
                            <button itype="button" class="btn btnPush btnLightBlue">상품주문</button>
                            <button type="button" class="btn btnPush btnRed">삭제</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        let id = /*[[${id}]]*/


        const interestList = () => {
            $.ajax({
                url: 'prodInterestList',
                method : 'GET',
                data : {meId : id},
                success : (data) => {
                    //console.log(data);
                    drawList(data);
                },
                error : (err) => {
                    console.log(err);
                }
            })
        };
        interestList();

        function drawList(data){
            let opt ="";
            for(let i = 0; i < data.length; i++) {
                let date = dateChange(data[i].intInDt);
                let price = AddComma(data[i].prdtPrc);
                //console.log(data[i].optionVal);
                opt += `
                        <tr>
                            <td>
                                <div style="margin:0 auto; display:inline-block;">
                                    <input type="checkbox">
                                </div>
                            </td>
                            <td><a href="ProductDetail?prdtId=${data[i].prdtId}"><img src="download/${data[i].prdtImg}" alt="prod_img"></a></td>
                            <td>
                                <span>${data[i].prdtNm}</span>
                                <div>${date}</div>
                            </td>
                            <td>${price}원</td>
                            <td>
                                <div style="margin:0 auto; display:inline-block;">
                                    <button type="button" class="btn btnPush btnBlueGreen" id="optionBtn_${data[i].prdtId}"
                                            onclick="document.getElementById('modal_${data[i].prdtId}').style.display='block'" >장바구니</button>
                                </div>

                                <div id="modal_${data[i].prdtId}" class="w3-modal m-t-50">
                                    <div class="w3-modal-content w3-animate-opacity w3-card-4">
                                        <span onclick="document.getElementById('modal_${data[i].prdtId}').style.display='none'" 
                                                class="w3-button w3-display-topright">&times;</span>
                                        <h3>옵션선택</h3>
                                        <div class="w3-container" style="height: 400px !important;">
                                            <div>
                                                <!-- 사이즈 -->
                                                <div id="div2">`;

                            tempOptId  = "";                                                  
                            for(let j = 0 ; j < data[i].optionVal.length ; j++){
                                if(j == 0){
                                    opt += `${data[i].optionVal[j].optNm}<select name="optDetaId">`;
                                } else if(data[i].optionVal[j].optId != tempOptId){
                                    opt += `</select><br/>${data[i].optionVal[j].optNm}<select name="optDetaId">`;
                                }
                                console.log(data[i].optionVal);
                                opt += `<option value="${data[i].optionVal[j].optDetaId}" data-price = "${data[i].optionVal[j].addPrc}">${data[i].optionVal[j].optDetaNm}</option>`
                                tempOptId = data[i].optionVal[j].optId;
                            }
                            opt += `</select>`;


                            opt += `
                                                    <!--<div class="optionTitle">
                                                        <span class="labelW">사이즈</span>
                                                    </div>-->
                                                    <button type="button" id="insert">테스트</button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        `;

                        

                //상품옵션
                //let prdtId = data[i].prdtId;
                /* $.ajax({
                    url: "prdtoption",
                    method: "GET",
                    data : {prdtId : prdtId},
                    success: function(data){
                        console.log(data);
                        for(let i = 0 ; i < data.length ; i++){
                            const productOptId = data[i].optId;
                            let productName = data[i].optNm;
                            let select = document.createElement("select");
                            select.name = data[i].optNm;

                            for(let j = 0; j < data[i].optionVal.length; j++) {
                                let option = document.createElement("option");
                                option.innerText = data[i].optionVal[j].optDetaNm;
                                option.value = data[i].optionVal[j].optDetaId;
                                select.append(option);
                            }

                            $('#div2').append(select);
                        };
                    },
                    error : function(rej) {
                        console.log(rej);
                    }
                })*/
                
                //DB에 있는 값이 없으면 없다고 띄우기
                if(data.length == 0){
                    let tr = document.createElement('tr');
                    let td = document.createElement('td');
                    $(td).attr('colspan', '8');
                    
                    td.innerHTML = `<div style="height: 600px;"><p style="color:gray; font-size:20px;"><strong>조회할 정보가 없습니다.</strong></p><div>`
                    tr.appendChild(td);
                    document.querySelector('#getOrderList').appendChild(tr);
                };
            }// end for
            list.innerHTML = opt;
        };

        $('#insert').on('click',(e)=>{
            console.log(e);
        })

        function domId(id) { //id로 태그찾기 압축용
            return document.getElementById(id);
        }

        //날짜변환
        function dateChange(data) {
            let newData = new Date(data);
            let result = newData.getFullYear() + "-" +
            (newData.getMonth() < 10
            ? "0" + (newData.getMonth() + 1)
            : newData.getMonth() + 1) +
            "-" + (newData.getDate() < 10 ? "0" + newData.getDate() : newData.getDate());
            return result;
        };

        //금액포맷
        function AddComma(num) {
            var regexp = /\B(?=(\d{3})+(?!\d))/g;
            return num.toString().replace(regexp, ',');
        };

    </script>
</div>
</body>
</html>
</html>